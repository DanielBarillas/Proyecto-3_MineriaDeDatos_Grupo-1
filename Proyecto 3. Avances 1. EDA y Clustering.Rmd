---
title: "Proyecto 3. Avances 1. Eda y Clustering"
author: 
  - "Pablo Daniel Barillas Moreno, Carn√© No. 22193"
  - "Mathew Cordero Aquino, Carn√© No. 22982"
output:
  pdf_document:
    latex_engine: xelatex
  html_document: default
date: "2025-03-14"
header-includes:
   - \usepackage{fvextra}
   - \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
repository: "https://github.com/DanielBarillas/Proyecto-3_MineriaDeDatos_Grupo-1.git"
---

### Enlace al Repositorio del proyecto 3 de miner√≠a de datos del Grupo #1
[Repositorio en GitHub](https://github.com/DanielBarillas/Proyecto-3_MineriaDeDatos_Grupo-1.git)

### 0. Descargar los conjuntos de datos.

Para este punto ya se descargo a√±o por a√±o el .sav (formato SPSS) de la p√°gina [Instituto Nacional de Estad√≠stica - Guatemala](https://www.ine.gob.gt/vitales/), de nacimiento de bebes del pa√≠s (Guatemala), para su posterior an√°lisis.

```{r}
# Importar librer√≠as necesarias
library(haven)
library(dplyr)

# Ruta de la carpeta con los archivos .sav
ruta <- "Nacimientos"
archivos <- list.files(path = ruta, pattern = "\\.sav$", full.names = TRUE)

# Leer y resumir cada archivo
resumen <- lapply(archivos, function(archivo) {
  tryCatch({
    datos <- read_sav(archivo)
    list(
      archivo = basename(archivo),
      observaciones = nrow(datos),
      variables = ncol(datos),
      columnas = names(datos)
    )
  }, error = function(e) {
    list(
      archivo = basename(archivo),
      error = as.character(e)
    )
  })
})

# Mostrar resumen
print(resumen)

```
---
Para este an√°lisis se utilizaron los registros de nacimientos publicados por el Instituto Nacional de Estad√≠stica (INE) desde el a√±o 2009 hasta 2022, en formato .sav (SPSS). En total, se procesaron 14 archivos, cada uno correspondiente a un a√±o.

Cada archivo contiene datos individuales de nacimientos ocurridos en el pa√≠s, con variables sobre el menor, la madre, el padre y condiciones del nacimiento.

### 1. Exploren los datos para encontrar preguntas interesantes y gu√≠as de investigaci√≥n. Para esto: 

## a.	Describan el conjunto de datos: cuantas variables y observaciones hay y el tipo de cada una de las variables.

```{r}
# Importar librer√≠as necesarias
library(haven)
library(dplyr)

ruta <- "Nacimientos"
archivos <- list.files(path = ruta, pattern = "\\.sav$", full.names = TRUE)

# Crear lista vac√≠a para resumen
resumen_general <- list()

for (archivo in archivos) {
  cat("üìÅ Procesando:", basename(archivo), "\n")
  tryCatch({
    df <- read_sav(archivo)
    
    resumen <- tibble(
      archivo = basename(archivo),
      observaciones = nrow(df),
      variables = ncol(df),
      columnas = paste(names(df), collapse = ", ")
    )
    
    resumen_general[[archivo]] <- resumen
    
    rm(df)  # Liberar memoria
    gc()
  }, error = function(e) {
    message("‚ùå Error leyendo ", basename(archivo))
  })
}

# Unir resumen de todos los archivos
resumen_final <- bind_rows(resumen_general)

# Mostrar resultado
print(resumen_final)
```
---

**Descripci√≥n General del Conjunto de Datos**

Para este an√°lisis se utilizaron los registros de nacimientos publicados por el Instituto Nacional de Estad√≠stica (INE) desde el a√±o **2009 hasta 2022**, en formato `.sav` (SPSS). En total, se procesaron **14 archivos**, cada uno correspondiente a un a√±o.

Cada archivo contiene datos individuales de nacimientos ocurridos en el pa√≠s, con variables sobre el menor, la madre, el padre y condiciones del nacimiento.

**Resumen por a√±o:**

| A√±o  | Observaciones  | Variables |
|------|----------------|-----------|
| 2009 | 351,628        | 37        |
| 2010 | 361,906        | 39        |
| 2011 | 373,692        | 39        |
| 2012 | 388,613        | 41        |
| 2013 | 387,342        | 41        |
| 2014 | 386,195        | 39        |
| 2015 | 391,425        | 42        |
| 2016 | 390,382        | 42        |
| 2017 | 381,664        | 42        |
| 2018 | 383,263        | 42        |
| 2019 | 366,855        | 42        |
| 2020 | 341,212        | 42        |
| 2021 | 345,149        | 42        |
| 2022 | 345,869        | 42        |

**Totales:**

- **Total de observaciones:** 5,048,195
- **Variables m√≠nimas por a√±o:** 37
- **Variables m√°ximas por a√±o:** 42

> Algunas variables tienen nombres distintos en ciertos a√±os, pero representan la misma informaci√≥n. Se estandarizar√°n para el an√°lisis posterior. Cuando una variable no est√° presente en todos los a√±os, se conservar√° con valores `NA` seg√∫n corresponda.

---

```{r}
# Importar librer√≠as necesarias
library(haven)
library(dplyr)
library(purrr)

ruta <- "Nacimientos"
archivos <- list.files(path = ruta, pattern = "\\.sav$", full.names = TRUE)

resumen_variables <- list()

for (archivo in archivos) {
  cat("üìÅ Procesando:", basename(archivo), "\n")
  tryCatch({
    df <- read_sav(archivo)

    # Verifica que el data frame tenga nombres de columna v√°lidos
    if (!is.null(names(df))) {
      resumen <- tibble(
        archivo = basename(archivo),
        variable = names(df),
        tipo = sapply(df, function(x) class(x)[1]),
        ejemplo = sapply(df, function(x) as.character(x[1]))
      )
      resumen_variables[[archivo]] <- resumen
    } else {
      message("‚ö†Ô∏è Sin nombres de columnas: ", basename(archivo))
    }

    rm(df)
    gc()
  }, error = function(e) {
    message("‚ùå Error con ", basename(archivo), ": ", e$message)
  })
}

# Unir resultados v√°lidos
resumen_total <- bind_rows(resumen_variables)

# Crear resumen por variable
resumen_por_variable <- resumen_total %>%
  group_by(variable) %>%
  summarise(
    tipo_mas_frecuente = names(sort(table(tipo), decreasing = TRUE))[1],
    ejemplo = first(na.omit(ejemplo)),
    aparece_en = n_distinct(archivo),
    .groups = "drop"
  ) %>%
  arrange(desc(aparece_en))

# Mostrar resultado
print(resumen_por_variable)
```

---

**1.a. Descripci√≥n del conjunto de datos**

El conjunto de datos corresponde a los registros de nacimientos recopilados por el Instituto Nacional de Estad√≠stica (INE) de Guatemala, desde el a√±o **2009 hasta 2022**, en formato `.sav` (SPSS). Cada archivo representa un a√±o y contiene informaci√≥n detallada sobre cada nacimiento ocurrido en el pa√≠s.

---

**Contenido general:**

- **A√±os analizados:** 14 (2009 a 2022)
- **Total de observaciones:** 5,048,195 nacimientos
- **Cantidad de variables por a√±o:** entre **37 y 42**

---

**Variables principales y tipos**

A continuaci√≥n se muestra una clasificaci√≥n de los tipos de variables m√°s comunes en los archivos:

|**Tipo de Variable**           |**Ejemplos de variables**                   |**Descripci√≥n**                                     |
|-------------------------------|--------------------------------------------|----------------------------------------------------|
| **Categ√≥ricas nominales**     | `Sexo`, `Tipar`, `Asisrec`, `Sitioocu`     | Identifican categor√≠as sin orden espec√≠fico        |
| **Categ√≥ricas ordinales**     | `Escolap`, `Escolam`, `Escivp`, `Escivm`   | Categor√≠as ordenadas (ej. niveles de educaci√≥n)    |
| **Num√©ricas discretas**       | `Edadp`, `Edadm`, `Libras`, `Onzas`        | Variables contables como edad y peso al nacer      |
| **Ubicaci√≥n geogr√°fica**      | `Depreg`, `Mupreg`, `Depocu`, `Mupocu`     | Departamento y municipio de registro y ocurrencia  |
| **Informaci√≥n del padre**     | `Ocupap`, `Escolap`, `Depnap`, `Naciop`    | Datos laborales y educativos del padre             |
| **Informaci√≥n de la madre**   | `Ocupam`, `Escolam`, `Edadp`, `Naciom`     | Datos laborales, educativos y de edad de la madre  |
| **Identificadores temporales**| `Mesreg`, `A√±oreg`, `Mesocu`, `A√±oocu`     | Fechas de registro y ocurrencia del nacimiento     |

---

**Notas importantes:**

- Algunas variables tienen **nombres distintos entre a√±os**, pero representan la misma informaci√≥n (ej. `"ViaPar"` vs `"Viapar"`).
- En el an√°lisis se conservar√°n **todas las columnas**, y se colocar√° `NA` cuando alguna variable no est√© presente en ciertos a√±os.
- Se priorizar√° la estandarizaci√≥n de nombres antes de an√°lisis agregados o gr√°ficos.

---

## b.	Realicen un resumen de las variables num√©ricas e investiguen si siguen una distribuci√≥n normal y, para las variables categ√≥ricas obtengan una tabla de frecuencia, documenten lo que vayan encontrando.

```{r}
library(haven)
library(dplyr)
library(ggplot2)

# Ruta donde est√°n los .sav
ruta <- "Nacimientos"
archivos <- list.files(path = ruta, pattern = "\\.sav$", full.names = TRUE)

# Variables clave
vars_numericas <- c("Edadp", "Libras", "Onzas")
vars_categoricas <- c("Sexo", "Tipar", "Escivp", "Escolap", "Asisrec", "Sitioocu")

for (archivo in archivos) {
  cat("\n\nüìÅ Analizando archivo:", basename(archivo), "\n")

  tryCatch({
    df <- read_sav(archivo)

    # Verificar qu√© variables existen
    vars_num_disponibles <- intersect(vars_numericas, names(df))
    vars_cat_disponibles <- intersect(vars_categoricas, names(df))

    # Conversi√≥n segura solo de columnas disponibles
    df <- df %>%
      mutate(
        across(all_of(vars_num_disponibles), ~as.numeric(as.character(.))),
        across(all_of(vars_cat_disponibles), ~as.factor(as.character(.)))
      )

    # FILTRAR VALORES IMPOSIBLES / AT√çPICOS
    if ("Edadp" %in% names(df)) df <- df %>% filter(Edadp >= 10 & Edadp <= 100)
    if ("Libras" %in% names(df)) df <- df %>% filter(Libras >= 1 & Libras <= 15)
    if ("Onzas" %in% names(df)) df <- df %>% filter(Onzas >= 1 & Onzas <= 15)  # Quitamos los ceros

    # Resumen num√©rico por variable
    if (length(vars_num_disponibles) > 0) {
      cat("\nüìã Resumen estad√≠stico de variables num√©ricas:\n")
      resumen <- df %>%
        summarise(across(all_of(vars_num_disponibles), list(
          media = ~mean(., na.rm = TRUE),
          mediana = ~median(., na.rm = TRUE),
          min = ~min(., na.rm = TRUE),
          max = ~max(., na.rm = TRUE),
          sd = ~sd(., na.rm = TRUE)
        ), .names = "{.col}_{.fn}"))
      print(resumen)

      # Histogramas
      for (var in vars_num_disponibles) {
        print(ggplot(df, aes_string(x = var)) +
                geom_histogram(bins = 30, fill = "skyblue", color = "black") +
                labs(title = paste("Distribuci√≥n de", var, "en", basename(archivo))))
      }
    } else {
      cat("\n‚ö†Ô∏è No se encontraron variables num√©ricas disponibles.\n")
    }

    # Frecuencias de categ√≥ricas
    if (length(vars_cat_disponibles) > 0) {
      cat("\nüìã Tablas de frecuencia (variables categ√≥ricas):\n")
      for (cat_var in vars_cat_disponibles) {
        cat("\nüî∏ Frecuencia de", cat_var, ":\n")
        print(table(df[[cat_var]], useNA = "ifany"))
      }
    } else {
      cat("\n‚ö†Ô∏è No se encontraron variables categ√≥ricas disponibles.\n")
    }

    # Observaciones
    cat("\nüìù Observaciones sugeridas:\n")
    cat("- Las variables num√©ricas han sido limpiadas de outliers y ceros inv√°lidos.\n")
    cat("- Eval√∫a si las distribuciones son normales.\n")
    cat("- Observa los valores m√°s frecuentes por categor√≠a.\n")
    cat("\nüîç Preguntas:\n")
    cat("- ¬øLas variables num√©ricas tienen forma de campana (normal)?\n")
    cat("- ¬øExisten valores at√≠picos?\n")
    cat("- ¬øQu√© categor√≠as son m√°s comunes en sexo, tipo de parto, asistencia m√©dica?\n")
    cat("- ¬øHay diferencias llamativas en los a√±os?\n")
    

    rm(df)
    gc()

  }, error = function(e) {
    message("‚ùå Error leyendo ", basename(archivo), ": ", e$message)
  })
}
```

## c.	Crucen las variables que consideren sean las m√°s importantes para hallar los elementos clave que permitan comprender lo que est√° causando el problema encontrado.**

```{r}
library(haven)
library(dplyr)
library(ggplot2)

# Ruta donde est√°n los archivos .sav
ruta <- "Nacimientos"
archivos <- list.files(path = ruta, pattern = "\\.sav$", full.names = TRUE)

# Variables que vamos a cruzar
vars_necesarias <- c("Edadp", "Tipar", "Sexo", "Libras", "Onzas")

# Loop para leer y analizar todos los archivos
for (archivo in archivos) {
  cat("\n\nüìÅ Analizando archivo:", basename(archivo), "\n")
  
  tryCatch({
    df <- read_sav(archivo)

    # Convertir a formatos adecuados
    df <- df %>%
      mutate(
        Edadp = as.numeric(as.character(Edadp)),
        Libras = as.numeric(as.character(Libras)),
        Onzas = as.numeric(as.character(Onzas)),
        Tipar = as.factor(as.character(Tipar)),
        Sexo = as.factor(as.character(Sexo)),
        peso_total = Libras + (Onzas / 16)
      )

    # Verificar que las variables est√©n presentes
    if (all(c("Edadp", "Tipar") %in% names(df))) {
      print(ggplot(df, aes(x = Tipar, y = Edadp)) +
              geom_boxplot(fill = "lightblue") +
              labs(title = paste("Edad del padre/madre vs. Tipo de parto ‚Äî", basename(archivo)),
                   x = "Tipo de parto", y = "Edad del padre/madre"))
    }

    if (all(c("Sexo", "peso_total") %in% names(df))) {
      print(ggplot(df, aes(x = Sexo, y = peso_total)) +
              geom_boxplot(fill = "lightgreen") +
              labs(title = paste("Peso al nacer vs. Sexo del beb√© ‚Äî", basename(archivo)),
                   x = "Sexo", y = "Peso total (libras)"))
    }

    # Observaciones sugeridas
    cat("\nüß† Observaciones sugeridas:\n")
    cat("- ¬øHay diferencias de edad en los tipos de parto?\n")
    cat("- ¬øEl sexo del beb√© influye en el peso al nacer?\n")
    cat("- ¬øExisten patrones por a√±o?\n")

    rm(df)
    gc()

  }, error = function(e) {
    message("‚ùå Error procesando ", basename(archivo), ": ", e$message)
  })
}
```

```{r}
library(haven)
library(dplyr)
library(ggplot2)

ruta <- "Nacimientos"
archivos <- list.files(path = ruta, pattern = "\\.sav$", full.names = TRUE)

# Etiquetas para tipo de parto
etiquetas_tipar <- c("1" = "Vaginal", "2" = "Ces√°rea", "3" = "No especificado", "4" = "No aplica")

# Variables que interesan
vars_numericas <- c("Edadp", "Libras", "Onzas")
vars_categoricas <- c("Sexo", "Escivp", "Escolap", "Asisrec", "Sitioocu")

for (archivo in archivos) {
  cat("\n\nüìÅ Procesando archivo:", basename(archivo), "\n")

  tryCatch({
    df <- read_sav(archivo)

    # Convertir manualmente Tipar con etiquetas
    if ("Tipar" %in% names(df)) {
      df$Tipar <- as.character(df$Tipar)
      df$Tipar <- recode(df$Tipar, !!!etiquetas_tipar)
      df$Tipar <- factor(df$Tipar)
    }

    # Convertir variables num√©ricas
    df <- df %>%
      mutate(
        Edadp = suppressWarnings(as.numeric(as.character(Edadp))),
        Libras = suppressWarnings(as.numeric(as.character(Libras))),
        Onzas = suppressWarnings(as.numeric(as.character(Onzas)))
      )

    # Convertir categ√≥ricas a factor si existen
    for (var in vars_categoricas) {
      if (var %in% names(df)) {
        df[[var]] <- as.factor(as.character(df[[var]]))
      }
    }

    # Filtrar valores v√°lidos
    df <- df %>% filter(Edadp < 90, Libras <= 10, Onzas <= 15)

    # üìä Edadp
    if ("Edadp" %in% names(df)) {
      print(ggplot(df, aes(x = Edadp)) +
              geom_histogram(bins = 30, fill = "skyblue", color = "black") +
              labs(title = paste("Distribuci√≥n de Edadp en", basename(archivo))) +
              scale_x_continuous(breaks = seq(10, 90, by = 10)))
    }

    # üìä Libras
    if ("Libras" %in% names(df)) {
      print(ggplot(df, aes(x = Libras)) +
              geom_histogram(binwidth = 1, fill = "lightgreen", color = "black") +
              labs(title = paste("Distribuci√≥n de Libras en", basename(archivo))) +
              scale_x_continuous(breaks = seq(1, 10, by = 1)))
    }

    # üìä Onzas
    if ("Onzas" %in% names(df)) {
      print(ggplot(df, aes(x = Onzas)) +
              geom_histogram(binwidth = 1, fill = "lightcoral", color = "black") +
              labs(title = paste("Distribuci√≥n de Onzas en", basename(archivo))) +
              scale_x_continuous(breaks = 0:15))
    }

    # üì¶ Edad vs Tipo de parto
    if ("Edadp" %in% names(df) && "Tipar" %in% names(df)) {
      print(ggplot(df, aes(x = Tipar, y = Edadp)) +
              geom_boxplot(fill = "orchid", outlier.size = 0.8) +
              labs(title = paste("Edad de la madre vs. Tipo de parto ‚Äî", basename(archivo)),
                   x = "Tipo de parto", y = "Edad de la madre"))
    }

    rm(df)
    gc()

  }, error = function(e) {
    message("‚ùå Error en ", basename(archivo), ": ", e$message)
  })
}
```

## d.	Realicen gr√°ficos exploratorios que les d√© ideas del estado de los datos.

```{r}

```


## e.	Hagan un agrupamiento ‚Äúclustering‚Äù e interpreten los resultados. 

```{r}

```


### 2. Una vez hayan explorado los datos...

## a.	Describan la situaci√≥n problem√°tica que los lleva a plantear un problema a resolver.

```{r}

```

## b.	Enuncien un problema cient√≠fico y unos objetivos preliminares.

```{r}

```

## c.	Describan los datos que tienen para responder el problema planteado. Esto incluye el estado en que se encontr√≥ el o los conjuntos de datos y las operaciones de limpieza que realizaron, en caso de que hayan sido necesarias.

```{r}

```

## d.	Escriban unas conclusiones con los hallazgos encontrados durante el an√°lisis exploratorio. 

```{r}

```

