---
title: "Proyecto 3. Avances 1. Eda y Clustering"
author: 
  - "Pablo Daniel Barillas Moreno, Carn√© No. 22193"
  - "Mathew Cordero Aquino, Carn√© No. 22982"
output:
  html_document: default
  pdf_document:
    latex_engine: xelatex
date: "2025-03-14"
header-includes:
   - \usepackage{fvextra}
   - \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
repository: "https://github.com/DanielBarillas/Proyecto-3_MineriaDeDatos_Grupo-1.git"
---

### Enlace al Repositorio del proyecto 3 de miner√≠a de datos del Grupo #1
[Repositorio en GitHub](https://github.com/DanielBarillas/Proyecto-3_MineriaDeDatos_Grupo-1.git)





---
title: "Proyecto 3. Avances 1. Eda y Clustering"
author: 
  - "Pablo Daniel Barillas Moreno, Carn√© No. 22193"
  - "Mathew Cordero Aquino, Carn√© No. 22982"
output:
  html_document: default
  pdf_document:
    latex_engine: xelatex
date: "2025-03-14"
header-includes:
   - \usepackage{fvextra}
   - \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
repository: "https://github.com/DanielBarillas/Proyecto-3_MineriaDeDatos_Grupo-1.git"
---

## Enlace al Repositorio del proyecto 3 de miner√≠a de datos del Grupo #1
[Repositorio en GitHub](https://github.com/DanielBarillas/Proyecto-3_MineriaDeDatos_Grupo-1.git)

## 0. Descargar los conjuntos de datos.

Para este punto ya se descargo el .sav (formato SPSS) de a√±o por a√±o de la p√°gina [Instituto Nacional de Estad√≠stica - Guatemala](https://www.ine.gob.gt/vitales/), de nacimiento de bebes del pa√≠s (Guatemala), para su posterior an√°lisis.

Para este an√°lisis se utilizaron los registros de nacimientos publicados por el Instituto Nacional de Estad√≠stica (INE) desde el a√±o 2009 hasta 2022, en formato .sav (SPSS). En total, se procesaron 14 archivos, cada uno correspondiente a un a√±o.

Cada archivo contiene datos individuales de nacimientos ocurridos en el pa√≠s, con variables sobre el menor, la madre, el padre y condiciones del nacimiento.

## 1. Exploren los datos para encontrar preguntas interesantes y gu√≠as de investigaci√≥n. Para esto: 

```{r}
library(haven)
library(dplyr)
library(purrr)
library(stringr)

# Ruta donde est√°n los .sav
ruta <- "Nacimientos"
archivos <- list.files(path = ruta, pattern = "\\.sav$", full.names = TRUE)

# Diccionario de equivalencias para unificar nombres
diccionario_nombres <- c(
  "Viapar"     = "ViaPar",
  "Pueblopp"   = "PuebloPP",
  "Pueblopm"   = "PuebloPM",
  "ciuomad"    = "Ciuomad",
  "ciuopad"    = "Ciuopad",
  "munnam"     = "Munpnam",
  "mupreg"     = "Mupreg",
  "muprep"     = "Muprep",
  "muprem"     = "Muprem",
  "mupnam"     = "Mupnam"
)

# Funci√≥n para renombrar columnas seg√∫n diccionario
renombrar_columnas <- function(df) {
  names(df) <- recode(names(df), !!!diccionario_nombres)
  return(df)
}

# Paso 1: Obtener todas las columnas posibles estandarizadas
nombres_globales <- archivos %>%
  map(~ {
    df <- read_sav(.x)
    names(df) <- recode(names(df), !!!diccionario_nombres)
    names(df)
  }) %>%
  flatten_chr() %>%
  unique()

# Paso 2: Leer, limpiar, completar y etiquetar a√±o
leer_estandarizado <- function(archivo) {
  tryCatch({
    df <- read_sav(archivo)
    df <- renombrar_columnas(df)
    df <- df %>% mutate(across(everything(), as.character))

    # Agregar columnas faltantes como NA
    faltantes <- setdiff(nombres_globales, names(df))
    df[faltantes] <- NA
    df <- df[, nombres_globales]

    # Agregar columna del a√±o
    df$archivo <- basename(archivo)
    df$anio <- stringr::str_extract(df$archivo, "\\d{4}")

    return(df)
  }, error = function(e) {
    message("‚ùå Error en ", archivo, ": ", e$message)
    return(NULL)
  })
}

# Unir todos los archivos estandarizados
datos_completos <- archivos %>%
  map(leer_estandarizado) %>%
  bind_rows()

# üîÑ Convertir variables clave a num√©ricas
datos_completos <- datos_completos %>%
  mutate(
    Edadp = as.numeric(Edadp),
    Libras = as.numeric(Libras),
    Onzas = as.numeric(Onzas)
  )

# Guardar el .RData final
save(datos_completos, file = "datos_nacimientos_de_2009_a_2022.RData")

cat("‚úÖ Archivo listo: 'datos_nacimientos_limpio.RData'\n")
cat("üì¶ Observaciones:", nrow(datos_completos), " | Variables:", ncol(datos_completos), "\n")
```
```{r}
# Cargar el archivo
load("datos_nacimientos_de_2009_a_2022.RData")

# Verifica si el objeto se carg√≥ correctamente
ls()  # Deber√≠a mostrar "datos_completos"

# Verifica estructura
str(datos_completos)

# Total de observaciones y variables
cat("üîé Observaciones:", nrow(datos_completos), "\n")
cat("üîé Variables:", ncol(datos_completos), "\n")

# Verifica cu√°ntos registros hay por archivo original
table(datos_completos$archivo)
```
```{r}
# Cargar datos unificados
load("datos_nacimientos_de_2009_a_2022.RData")

library(dplyr)
library(tidyr)

# 1. Porcentaje de NA por columna
porcentaje_na <- datos_completos %>%
  summarise(across(everything(), ~mean(is.na(.))*100)) %>%
  pivot_longer(everything(), names_to = "variable", values_to = "porcentaje_na") %>%
  arrange(desc(porcentaje_na))

# 2. En qu√© a√±os aparece cada variable (con datos no vac√≠os)
presencia_por_a√±o <- datos_completos %>%
  group_by(archivo) %>%
  summarise(across(everything(), ~sum(!is.na(.)) > 0)) %>%
  pivot_longer(-archivo, names_to = "variable", values_to = "presente") %>%
  filter(presente == TRUE) %>%
  group_by(variable) %>%
  summarise(anios_con_dato = n()) %>%
  arrange(desc(anios_con_dato))

# 3. Unir resumen
resumen_variables <- porcentaje_na %>%
  left_join(presencia_por_a√±o, by = "variable")

# 4. Ver tabla final
print(resumen_variables)
```

### a.	Describan el conjunto de datos: cuantas variables y observaciones hay y el tipo de cada una de las variables.

```{r}
# Cargar archivo
load("datos_nacimientos_de_2009_a_2022.RData")  # o datos_nacimientos_limpio.RData

library(dplyr)

# Obtener total de observaciones y variables
cat("üìä Total de observaciones:", nrow(datos_completos), "\n")
cat("üìä Total de variables:", ncol(datos_completos), "\n\n")

# Crear tabla con nombre, tipo y ejemplo por variable
resumen_variables <- tibble(
  variable = names(datos_completos),
  tipo = sapply(datos_completos, class),
  ejemplo = sapply(datos_completos, function(x) {
    first(na.omit(x))
  })
)

# Mostrar tabla resumen
print(resumen_variables)
```

```{r}
# Importar librer√≠as necesarias
library(haven)
library(dplyr)

# Ruta de la carpeta con los archivos .sav
ruta <- "Nacimientos"
archivos <- list.files(path = ruta, pattern = "\\.sav$", full.names = TRUE)

# Leer y resumir cada archivo
resumen <- lapply(archivos, function(archivo) {
  tryCatch({
    datos <- read_sav(archivo)
    list(
      archivo = basename(archivo),
      observaciones = nrow(datos),
      variables = ncol(datos),
      columnas = names(datos)
    )
  }, error = function(e) {
    list(
      archivo = basename(archivo),
      error = as.character(e)
    )
  })
})

# Mostrar resumen
print(resumen)
```

**Descripci√≥n General del Conjunto de Datos**

Para este an√°lisis se utilizaron los registros de nacimientos publicados por el Instituto Nacional de Estad√≠stica (INE) desde el a√±o **2009 hasta 2022**, en formato `.sav` (SPSS). En total, se procesaron **14 archivos**, cada uno correspondiente a un a√±o.

Cada archivo contiene datos individuales de nacimientos ocurridos en el pa√≠s, con variables sobre el menor, la madre, el padre y condiciones del nacimiento.

**Resumen por a√±o:**

| A√±o  | Observaciones  | Variables |
|------|----------------|-----------|
| 2009 | 351,628        | 37        |
| 2010 | 361,906        | 39        |
| 2011 | 373,692        | 39        |
| 2012 | 388,613        | 41        |
| 2013 | 387,342        | 41        |
| 2014 | 386,195        | 39        |
| 2015 | 391,425        | 42        |
| 2016 | 390,382        | 42        |
| 2017 | 381,664        | 42        |
| 2018 | 383,263        | 42        |
| 2019 | 366,855        | 42        |
| 2020 | 341,212        | 42        |
| 2021 | 345,149        | 42        |
| 2022 | 345,869        | 42        |

**Totales:**

- **Total de observaciones:** 5,195,195
- **Variables m√≠nimas por a√±o:** 37
- **Variables m√°ximas por a√±o:** 42

> Algunas variables tienen nombres distintos en ciertos a√±os, pero representan la misma informaci√≥n. Se estandarizar√°n para el an√°lisis posterior. Cuando una variable no est√° presente en todos los a√±os, se conservar√° con valores `NA` seg√∫n corresponda.

**Descripci√≥n del conjunto de datos**

El conjunto de datos corresponde a los registros de nacimientos recopilados por el Instituto Nacional de Estad√≠stica (INE) de Guatemala, desde el a√±o **2009 hasta 2022**, en formato `.sav` (SPSS). Cada archivo representa un a√±o y contiene informaci√≥n detallada sobre cada nacimiento ocurrido en el pa√≠s.

**Contenido general:**

- **A√±os analizados:** 14 a√±os (de 2009 a 2022)
- **Total de observaciones:** 5,195,195 nacimientos
- **Cantidad de variables por a√±o:** entre **37 y 42**

**Variables y tipos**

A continuaci√≥n se muestra una clasificaci√≥n de los tipos de variables en los archivos:

| **Tipo de Variable**             | **Ejemplos de variables**                                                                                             | **Descripci√≥n**                                                 |
|----------------------------------|-----------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| **Categ√≥ricas nominales**        | `Sexo`, `Tipar`, `Asisrec`, `Sitioocu`, `ViaPar`, `PuebloPP`, `PuebloPM`                                              | Identifican categor√≠as sin orden espec√≠fico.                    |
| **Categ√≥ricas ordinales**        | `Escolap`, `Escolam`, `Escivp`, `Escivm`                                                                              | Categor√≠as con jerarqu√≠a, como nivel educativo o estado civil.  |
| **Num√©ricas discretas**          | `Edadp`, `Edadm`, `Libras`, `Onzas`, `Tohite`, `Tohinm`, `Tohivi`                                                     | Valores num√©ricos contables o discretos (no continuos).         |
| **Ubicaci√≥n geogr√°fica**         | `Depreg`, `Mupreg`, `Depocu`, `Mupocu`, `Deprep`, `Muprep`, `Deprem`, `Muprem`, `Depnap`, `Mupnap`, `Depnam`, `Mupnam`| Lugar de residencia, nacimiento o ocurrencia del evento.        |
| **Informaci√≥n del padre**        | `Ocupap`, `Escolap`, `Depnap`, `Naciop`, `Paisnacp`, `Paisrep`                                                        | Datos del padre: ocupaci√≥n, escolaridad, nacionalidad, etc.     |
| **Informaci√≥n de la madre**      | `Ocupam`, `Escolam`, `Edadp`, `Naciom`, `Paisnacm`, `Paisrem`                                                         | Datos de la madre: similares al padre, adem√°s de edad.          |
| **Identificadores temporales**   | `Mesreg`, `A√±oreg`, `Mesocu`, `A√±oocu`, `Diaocu`                                                                      | Datos de cu√°ndo ocurri√≥ y se registr√≥ el nacimiento.            |
| **Asistencia m√©dica y parto**    | `Sitioocu`, `TipoIns`, `Tipar`, `Asisrec`                                                                             | Caracter√≠sticas del parto y asistencia m√©dica recibida.         |
| **Tama√±o familiar**              | `Tohite`, `Tohinm`, `Tohivi`                                                                                          | Cantidad de hijos tenidos, vivos o informados.                  |
| **Otros c√≥digos del nacimiento** | `grupetma`, `Gretnp`, `Gretnm`, `Ciuopad`, `Ciuomad`, `Munpnam`                                                       | C√≥digos espec√≠ficos de clasificaci√≥n SPSS o registros puntuales.|
| **Identificaci√≥n del archivo**   | `archivo`, `anio`                                                                                                     | Metadatos del archivo origen y a√±o del registro.                |

**Notas importantes:**

- Algunas variables tienen **nombres distintos entre a√±os**, pero representan la misma informaci√≥n (ej. `"ViaPar"` vs `"Viapar"`).
- En el an√°lisis se conservar√°n **todas las columnas**, y se colocar√° `NA` cuando alguna variable no est√© presente en ciertos a√±os.
- Se priorizar√° la estandarizaci√≥n de nombres antes de an√°lisis agregados o gr√°ficos.

**A continuaci√≥n se tienen la descripci√≥n y clasificaci√≥n de todas las variables:**

| **Variable**   | **Descripci√≥n**                                                                  |
|----------------|----------------------------------------------------------------------------------|
| Depreg         | C√≥digo del departamento donde se registr√≥ el nacimiento                          |
| Mupreg         | C√≥digo del municipio donde se registr√≥ el nacimiento                             |
| Mesreg         | Mes de registro del nacimiento                                                   |
| A√±oreg         | A√±o de registro del nacimiento                                                   |
| Depocu         | C√≥digo del departamento donde ocurri√≥ el nacimiento                              |
| Mupocu         | C√≥digo del municipio donde ocurri√≥ el nacimiento                                 |
| Libras         | Peso del beb√© al nacer en libras                                                 |
| Onzas          | Peso del beb√© al nacer en onzas                                                  |
| Diaocu         | D√≠a en que ocurri√≥ el nacimiento                                                 |
| Mesocu         | Mes en que ocurri√≥ el nacimiento                                                 |
| A√±oocu         | A√±o en que ocurri√≥ el nacimiento                                                 |
| Sexo           | Sexo del beb√© (1 = Hombre, 2 = Mujer)                                            |
| Tipar          | Tipo de parto (1 = Vaginal, 2 = Ces√°rea, etc.)                                   |
| Edadp          | Edad del padre en a√±os                                                           |
| Deprep         | Departamento de residencia del padre                                             |
| Muprep         | Municipio de residencia del padre                                                |
| Escivp         | Estado civil del padre                                                           |
| Depnap         | Departamento de nacimiento del padre                                             |
| Mupnap         | Municipio de nacimiento del padre                                                |
| Naciop         | Nacionalidad del padre (c√≥digo)                                                  |
| Ocupap         | Ocupaci√≥n del padre (seg√∫n clasificaci√≥n nacional)                               |
| Edadm          | Edad de la madre en a√±os                                                         |
| Deprem         | Departamento de residencia de la madre                                           |
| Muprem         | Municipio de residencia de la madre                                              |
| Escivm         | Estado civil de la madre                                                         |
| Depnam         | Departamento de nacimiento de la madre                                           |
| Mupnam         | Municipio de nacimiento de la madre                                              |
| Naciom         | Nacionalidad de la madre (c√≥digo)                                                |
| Ocupam         | Ocupaci√≥n de la madre                                                            |
| Escolap        | Nivel educativo alcanzado por el padre                                           |
| Escolam        | Nivel educativo alcanzado por la madre                                           |
| Paisrep        | Pa√≠s de residencia del padre                                                     |
| Paisrem        | Pa√≠s de residencia de la madre                                                   |
| Paisnacp       | Pa√≠s de nacimiento del padre                                                     |
| Paisnacm       | Pa√≠s de nacimiento de la madre                                                   |
| Asisrec        | Si hubo asistencia m√©dica en el nacimiento                                       |
| Sitioocu       | Lugar donde ocurri√≥ el nacimiento (hospital, casa, etc.)                         |
| TipoIns        | Tipo de instituci√≥n que atendi√≥ el parto (si aplica)                             |
| ViaPar / Viapar| V√≠a del parto (puede ser duplicado en nombre)                                    |
| PuebloPP       | Pertenencia √©tnica del padre (pueblo ind√≠gena, mestizo, etc.)                    |
| PuebloPM       | Pertenencia √©tnica de la madre                                                   |
| Tohite         | Total de hijos tenidos                                                           |
| Tohinm         | Total de hijos nacidos muertos                                                   |
| Tohivi         | Total de hijos vivos                                                             |
| grupetma       | Clasificaci√≥n del grupo √©tnico de la madre (c√≥digo)                              |
| Gretnp         | Grupo √©tnico del padre                                                           |
| Gretnm         | Grupo √©tnico de la madre                                                         |
| Ciuopad        | Ciudad de nacimiento del padre (algunos a√±os)                                    |
| Ciuomad        | Ciudad de nacimiento de la madre (algunos a√±os)                                  |
| Munpnam        | Municipio de nacimiento de la madre (alternativa a munnam)                       |
| archivo        | Nombre del archivo del cual se extrajo el dato                                   |
| anio           | A√±o correspondiente al archivo (2009‚Äì2022)                                       |

### b.	Realicen un resumen de las variables num√©ricas e investiguen si siguen una distribuci√≥n normal y, para las variables categ√≥ricas obtengan una tabla de frecuencia, documenten lo que vayan encontrando.

```{r}
# üîß Filtrar valores at√≠picos y mantener datos consistentes
datos_limpios <- datos_completos %>%
  mutate(
    Edadp  = as.numeric(Edadp),
    Edadm  = as.numeric(Edadm),
    Libras = as.numeric(Libras),
    Onzas  = as.numeric(Onzas),
    Tohite = as.numeric(Tohite),
    Tohinm = as.numeric(Tohinm),
    Tohivi = as.numeric(Tohivi)
  ) %>%
  filter(
    Edadp >= 10 & Edadp <= 90,
    Edadm >= 10 & Edadm <= 100,
    Libras >= 1 & Libras <= 10,
    Onzas >= 0 & Onzas <= 15,
    Tohite >= 0 & Tohite <= 20,
    Tohinm >= 0 & Tohinm <= 20,
    Tohivi >= 0 & Tohivi <= 20
  )

# Importar las librer√≠as necesarias
library(dplyr)
library(ggplot2)

# Variables a analizar
vars_numericas <- c("Edadp", "Edadm", "Libras", "Onzas", "Tohite", "Tohinm", "Tohivi")
vars_categoricas <- c("Sexo", "Tipar", "Asisrec", "Sitioocu", "Escivp", "Escivm")

# üìä Resumen estad√≠stico
resumen_numerico <- datos_limpios %>%
  select(all_of(vars_numericas)) %>%
  summarise(across(everything(), list(
    media = ~mean(., na.rm = TRUE),
    mediana = ~median(., na.rm = TRUE),
    sd = ~sd(., na.rm = TRUE),
    min = ~min(., na.rm = TRUE),
    max = ~max(., na.rm = TRUE)
  ), .names = "{.col}_{.fn}"))

print(resumen_numerico)

# üìà Histogramas (versi√≥n moderna de ggplot2 sin aes_string)
for (var in vars_numericas) {
  if (var %in% names(datos_limpios)) {
    print(
      ggplot(datos_limpios, aes(x = .data[[var]])) +
        geom_histogram(bins = 30, fill = "skyblue", color = "black") +
        labs(title = paste("Distribuci√≥n de", var), x = var, y = "Frecuencia")
    )
  }
}

# üìã Tablas de frecuencia para variables categ√≥ricas
for (var in vars_categoricas) {
  if (var %in% names(datos_limpios)) {
    cat("\nüìä Frecuencia de:", var, "\n")
    print(table(datos_limpios[[var]], useNA = "ifany"))
  }
}

```


### Analisis de los Hallazgos

Podemos ver que las edades medias y minimas son de 28 y 12 a√±os, al igual que las libras medias son de 6.3 a 6 , lo cual es un indide de una poblacion relativamente joven . 

Tambien vemos que conforme a los a√±o esta media de libras se ido desplazando mas hacia la derecha, Y que la cantidad de personas a aumentado mas a la edades grandes , lo que puede indicar que los nacimientos hemos visto que la poblacion ha aumentado esto puede mostrar a que la poblacion se ha hecho mucho mas anciana pero tambien aumento el peso de los mismos . Ello es posible que sea fruto de un sesgo dado a que ahora hay muchos mas adultos que antes. 


Tambien vemos que las onzas de los nacimientos se han visto distribuidos de una forma que no es normal, sino que puede deberse a datos atipicos que se ven sesgos en ambos extremos. 



### c.	Crucen las variables que consideren sean las m√°s importantes para hallar los elementos clave que permitan comprender lo que est√° causando el problema encontrado.**

```{r}
library(haven)
library(dplyr)
library(ggplot2)

# Ruta donde est√°n los archivos .sav
ruta <- "Nacimientos"
archivos <- list.files(path = ruta, pattern = "\\.sav$", full.names = TRUE)

# Variables que vamos a cruzar
vars_necesarias <- c("Edadp", "Tipar", "Sexo", "Libras", "Onzas")

# Loop para leer y analizar todos los archivos
for (archivo in archivos) {
  cat("\n\nüìÅ Analizando archivo:", basename(archivo), "\n")
  
  tryCatch({
    df <- read_sav(archivo)

    # Convertir a formatos adecuados
    df <- df %>%
      mutate(
        Edadp = as.numeric(as.character(Edadp)),
        Libras = as.numeric(as.character(Libras)),
        Onzas = as.numeric(as.character(Onzas)),
        Tipar = as.factor(as.character(Tipar)),
        Sexo = as.factor(as.character(Sexo)),
        peso_total = Libras + (Onzas / 16)
      )

    # Verificar que las variables est√©n presentes
    if (all(c("Edadp", "Tipar") %in% names(df))) {
      print(ggplot(df, aes(x = Tipar, y = Edadp)) +
              geom_boxplot(fill = "lightblue") +
              labs(title = paste("Edad del padre/madre vs. Tipo de parto ‚Äî", basename(archivo)),
                   x = "Tipo de parto", y = "Edad del padre/madre"))
    }

    if (all(c("Sexo", "peso_total") %in% names(df))) {
      print(ggplot(df, aes(x = Sexo, y = peso_total)) +
              geom_boxplot(fill = "lightgreen") +
              labs(title = paste("Peso al nacer vs. Sexo del beb√© ‚Äî", basename(archivo)),
                   x = "Sexo", y = "Peso total (libras)"))
    }

    # Observaciones sugeridas
    cat("\nüß† Observaciones sugeridas:\n")
    cat("- ¬øHay diferencias de edad en los tipos de parto?\n")
    cat("- ¬øEl sexo del beb√© influye en el peso al nacer?\n")
    cat("- ¬øExisten patrones por a√±o?\n")

    rm(df)
    gc()

  }, error = function(e) {
    message("‚ùå Error procesando ", basename(archivo), ": ", e$message)
  })
}
```

```{r}
library(haven)
library(dplyr)
library(ggplot2)

ruta <- "Nacimientos"
archivos <- list.files(path = ruta, pattern = "\\.sav$", full.names = TRUE)

# Etiquetas para tipo de parto
etiquetas_tipar <- c("1" = "Vaginal", "2" = "Ces√°rea", "3" = "No especificado", "4" = "No aplica")

# Variables que interesan
vars_numericas <- c("Edadp", "Libras", "Onzas")
vars_categoricas <- c("Sexo", "Escivp", "Escolap", "Asisrec", "Sitioocu")

for (archivo in archivos) {
  cat("\n\nüìÅ Procesando archivo:", basename(archivo), "\n")

  tryCatch({
    df <- read_sav(archivo)

    # Convertir manualmente Tipar con etiquetas
    if ("Tipar" %in% names(df)) {
      df$Tipar <- as.character(df$Tipar)
      df$Tipar <- recode(df$Tipar, !!!etiquetas_tipar)
      df$Tipar <- factor(df$Tipar)
    }

    # Convertir variables num√©ricas
    df <- df %>%
      mutate(
        Edadp = suppressWarnings(as.numeric(as.character(Edadp))),
        Libras = suppressWarnings(as.numeric(as.character(Libras))),
        Onzas = suppressWarnings(as.numeric(as.character(Onzas)))
      )

    # Convertir categ√≥ricas a factor si existen
    for (var in vars_categoricas) {
      if (var %in% names(df)) {
        df[[var]] <- as.factor(as.character(df[[var]]))
      }
    }

    # Filtrar valores v√°lidos
    df <- df %>% filter(Edadp < 90, Libras <= 10, Onzas <= 15)

    # üìä Edadp
    if ("Edadp" %in% names(df)) {
      print(ggplot(df, aes(x = Edadp)) +
              geom_histogram(bins = 30, fill = "skyblue", color = "black") +
              labs(title = paste("Distribuci√≥n de Edadp en", basename(archivo))) +
              scale_x_continuous(breaks = seq(10, 90, by = 10)))
    }

    # üìä Libras
    if ("Libras" %in% names(df)) {
      print(ggplot(df, aes(x = Libras)) +
              geom_histogram(binwidth = 1, fill = "lightgreen", color = "black") +
              labs(title = paste("Distribuci√≥n de Libras en", basename(archivo))) +
              scale_x_continuous(breaks = seq(1, 10, by = 1)))
    }

    # üìä Onzas
    if ("Onzas" %in% names(df)) {
      print(ggplot(df, aes(x = Onzas)) +
              geom_histogram(binwidth = 1, fill = "lightcoral", color = "black") +
              labs(title = paste("Distribuci√≥n de Onzas en", basename(archivo))) +
              scale_x_continuous(breaks = 0:15))
    }

    # üì¶ Edad vs Tipo de parto
    if ("Edadp" %in% names(df) && "Tipar" %in% names(df)) {
      print(ggplot(df, aes(x = Tipar, y = Edadp)) +
              geom_boxplot(fill = "orchid", outlier.size = 0.8) +
              labs(title = paste("Edad de la madre vs. Tipo de parto ‚Äî", basename(archivo)),
                   x = "Tipo de parto", y = "Edad de la madre"))
    }

    rm(df)
    gc()

  }, error = function(e) {
    message("‚ùå Error en ", basename(archivo), ": ", e$message)
  })
}
```


### Analisis de Variables y  Distribuciones

Ademas de las distribuciones de las variables podemos ver  en como se relacionan la edad de la madre con el tipo de parto, vemos que el mas comun es de vaginal y le sigue despues del de cesarea, tambien que las madres que tienen mas partos por cesarea son mas grandes en edad que las que no . Y el vaginal son mas jovenes, muy posiblemente por tema de la edad se debe esto 

Pero tambien podemos ver algo muy interesante y es que una gran parte de las madres son en mayor edad, y tambien que el parto por cesarea es mas comun que otros a√±os, esto puede indicar que muchas madres debido a la edad o por temas de seguridad deciden el uso de cesarea para poder dar a luz. 



## d.	Realicen gr√°ficos exploratorios que les d√© ideas del estado de los datos.


Para hacer este analisis debemos de profundizar sobre los datos, Por ello vamos a utilizar algunas graficos que representen lo que estamos buscando

Lo primero es responder a las preguntas por ejemplo

¬øEl sexo del beb√© influye en el peso al nacer?

Para ello realizamos el siguiente grafico



```{r}
library(haven)
library(dplyr)
library(ggplot2)

ruta <- "Nacimientos"
archivos <- list.files(path = ruta, pattern = "\\.sav$", full.names = TRUE)

for (archivo in archivos) {
  cat("\n\nüìÅ Procesando archivo:", basename(archivo), "\n")

  tryCatch({
    df <- read_sav(archivo)

    # Asegurar que las variables existen
    if (!all(c("Sexo", "Libras", "Onzas", "A√±oreg") %in% names(df))) {
      stop("Faltan variables necesarias en el archivo ", basename(archivo))
    }

    # Convertir a valores num√©ricos
    df <- df %>%
      mutate(
        Libras = suppressWarnings(as.numeric(as.character(Libras))),
        Onzas = suppressWarnings(as.numeric(as.character(Onzas))),
        Sexo = as.factor(as.character(Sexo)),
        peso_total = Libras + (Onzas / 16)
      ) %>%
      filter(peso_total > 1, peso_total <= 10)  # Filtrar pesos v√°lidos

    # Agrupar por a√±o y sexo para calcular el peso promedio
    df_resumen <- df %>%
      group_by(A√±oreg, Sexo) %>%
      summarise(peso_promedio = mean(peso_total, na.rm = TRUE), .groups = "drop")

    # Gr√°fica de barras con el peso promedio
    p <- ggplot(df_resumen, aes(x = Sexo, y = peso_promedio, fill = Sexo)) +
      stat_summary(fun = mean, geom = "bar", position = "dodge") +
      labs(title = "Peso promedio al nacer seg√∫n el sexo del beb√©",
           x = "Sexo del beb√©",
           y = "Peso al nacer (libras)") +
      theme_minimal()

    # Aseg√∫rate de imprimir la gr√°fica
    print(p)

    rm(df, df_resumen)
    gc()

  }, error = function(e) {
    message("‚ùå Error en ", basename(archivo), ": ", e$message)
  })
}








```

### Analisis del grafico
Podemos ver que realmente no afecta en nada el genero en la diferencia de pesos, si se puede ver que solo hay una ligera diferencia de pesos por las mujeres pesando menos pero no es mucho. Asi que puede ser por otros motivos



Otra forma para poder ver que esta afectando el peso de los bebes puede ser la edad en las que sus madres los tuvieorn. 
Por ello vamos a hacer el siguiente grafico




```{r}

library(haven)
library(dplyr)
library(ggplot2)

ruta <- "Nacimientos"
archivos <- list.files(path = ruta, pattern = "\\.sav$", full.names = TRUE)

# Etiquetas para tipo de parto
etiquetas_tipar <- c("1" = "Vaginal", "2" = "Ces√°rea", "3" = "No especificado", "4" = "No aplica")

# Variables que interesan
vars_numericas <- c("Edadp", "Libras", "Onzas")
vars_categoricas <- c("Sexo", "Escivp", "Escolap", "Asisrec", "Sitioocu")

for (archivo in archivos) {
  cat("\n\nüìÅ Procesando archivo:", basename(archivo), "\n")

  tryCatch({
    df <- read_sav(archivo)

    # Convertir manualmente Tipar con etiquetas
    if ("Tipar" %in% names(df)) {
      df$Tipar <- as.character(df$Tipar)
      df$Tipar <- recode(df$Tipar, !!!etiquetas_tipar)
      df$Tipar <- factor(df$Tipar)
    }

    # Convertir variables num√©ricas
    df <- df %>%
      mutate(
        Edadp = suppressWarnings(as.numeric(as.character(Edadp))),
        Libras = suppressWarnings(as.numeric(as.character(Libras))),
        Onzas = suppressWarnings(as.numeric(as.character(Onzas))),
        peso_total = Libras + (Onzas / 16)  # Calcular peso total en libras
      )

    # Convertir categ√≥ricas a factor si existen
    for (var in vars_categoricas) {
      if (var %in% names(df)) {
        df[[var]] <- as.factor(as.character(df[[var]]))
      }
    }

    # Filtrar valores v√°lidos
    df <- df %>% filter(Edadp < 90, Libras <= 10, Onzas <= 15)

    # üìä Peso vs Edad de la madre
    if ("Edadp" %in% names(df) && "peso_total" %in% names(df)) {
      print(ggplot(df, aes(x = Edadp, y = peso_total)) +
              geom_point(color = "steelblue", alpha = 0.6) +
              labs(title = paste("Relaci√≥n entre Edad de la madre y Peso al nacer en", basename(archivo)),
                   x = "Edad de la madre (a√±os)", y = "Peso al nacer (libras)") +
              theme_minimal())
    }

    rm(df)
    gc()

  }, error = function(e) {
    message("‚ùå Error en ", basename(archivo), ": ", e$message)
  })
}

```

### Analisis del grafico

Podemos ver que la mayor concentracion de los pesos es en 6  de kilos, y tambien que las madres que mas son las que tienen estos bebes son madres mucho mas grandes. De hecho se ve que las jovenes suelen dar a luz un rango de bebes mas pesados. Pero mientras mas jovenes tambien se ve que los pesos de los bebes suelen ser menos pesados al igual que las mas grandes. 

Esto producto a que las madres jovenes y mas grandes suelen tener mas problemas en el tiempo de gestacion ya sea por prematura o ser demasiado grandes al tener su hijo , lo que provoca nacimientos prematuros . 



Ahora nos haremos la siguiente pregunta y es la de si 


## e.	Hagan un agrupamiento ‚Äúclustering‚Äù e interpreten los resultados. 

```{r}

```


### 2. Una vez hayan explorado los datos...

## a.	Describan la situaci√≥n problem√°tica que los lleva a plantear un problema a resolver.

```{r}

```

## b.	Enuncien un problema cient√≠fico y unos objetivos preliminares.

```{r}

```

## c.	Describan los datos que tienen para responder el problema planteado. Esto incluye el estado en que se encontr√≥ el o los conjuntos de datos y las operaciones de limpieza que realizaron, en caso de que hayan sido necesarias.

```{r}

```

## d.	Escriban unas conclusiones con los hallazgos encontrados durante el an√°lisis exploratorio. 

```{r}

```

